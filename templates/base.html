<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>{% block title %}Green Calc{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <header class="main-header">
    <div class="logo">
      <a href="{{ url_for('main.index') }}">Green Calc</a>
    </div>
    <nav class="top-nav">
      <ul>
        <li><a href="{{ url_for('main.index') }}">Accueil</a></li>
        <li class="dropdown">
          <a href="#" id="myxploit-menu-trigger">MyXploit</a>
          <ul class="dropdown-menu">
            <li><a href="{{ url_for('main.myxploit') }}">🏠 Accueil MyXploit</a></li>
            <li><a href="{{ url_for('clients.clients') }}">👥 Mes Clients</a></li>
            <li><a href="{{ url_for('transporteurs.transporteurs') }}">🚚 Mes Transporteurs</a></li>
            <li><a href="{{ url_for('transports.mes_transports') }}">📦 Mes Transports</a></li>
            <li><a href="{{ url_for('main.dashboard') }}">📊 Mon Dashboard</a></li>
            <li class="dropdown-submenu">
              <a href="#">⚙️ Paramètres</a>
              <ul class="dropdown-submenu-content">
                <li><a href="{{ url_for('clients.mon_entreprise') }}">🏢 Mon Entreprise</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" id="admin-menu-trigger">Administration</a>
          <ul class="dropdown-menu">
            <li><a href="{{ url_for('admin.administration') }}">🏠 Accueil Administration</a></li>
            <li class="dropdown-submenu">
              <a href="#">👥 Clients</a>
              <ul class="dropdown-submenu-content">
                <li><a href="{{ url_for('admin.admin_clients') }}">📋 Liste des Clients</a></li>
                <li><a href="{{ url_for('admin.admin_invitations') }}">📧 Invitations</a></li>
                <li><a href="{{ url_for('admin.admin_clients_pending') }}">⏳ Clients en Attente</a></li>
              </ul>
            </li>
            <li><a href="{{ url_for('parametrage.parametrage_vehicules') }}">🚛 Types de Véhicules</a></li>
            <li><a href="{{ url_for('parametrage.parametrage_energies') }}">⚡ Gestion des Énergies</a></li>
            <li><a href="{{ url_for('parametrage.parametrage_impact') }}">🌱 Configuration de l'Impact</a></li>
            <li><a href="{{ url_for('parametrage.parametrage_systeme') }}">⚙️ Paramètres Système</a></li>
            <li><a href="{{ url_for('debug.debug_page') }}">🔧 Debug</a></li>
          </ul>
        </li>
      </ul>
    </nav>
    <div class="user-menu">
      <a href="{{ url_for('auth.logout') }}" class="btn-logout">Déconnexion</a>
    </div>
  </header>

  <!-- Barre de sous-menu MyXploit -->
  <nav class="submenu-bar" id="myxploit-submenu" style="display: none;">
    <div class="submenu-container">
      <a href="{{ url_for('main.myxploit') }}" class="submenu-item">
        <span class="submenu-icon">🏠</span>
        <span class="submenu-text">Accueil</span>
      </a>
      <a href="{{ url_for('clients.clients') }}" class="submenu-item">
        <span class="submenu-icon">👥</span>
        <span class="submenu-text">Mes Clients</span>
      </a>
      <a href="{{ url_for('transporteurs.transporteurs') }}" class="submenu-item">
        <span class="submenu-icon">🚚</span>
        <span class="submenu-text">Mes Transporteurs</span>
      </a>
      <a href="{{ url_for('transports.mes_transports') }}" class="submenu-item">
        <span class="submenu-icon">📦</span>
        <span class="submenu-text">Mes Transports</span>
      </a>
      <a href="{{ url_for('main.dashboard') }}" class="submenu-item">
        <span class="submenu-icon">📊</span>
        <span class="submenu-text">Mon Dashboard</span>
      </a>
      <a href="{{ url_for('clients.mon_entreprise') }}" class="submenu-item">
        <span class="submenu-icon">🏢</span>
        <span class="submenu-text">Mon Entreprise</span>
      </a>
    </div>
  </nav>

  <!-- Barre de sous-menu Administration -->
  <nav class="submenu-bar" id="admin-submenu" style="display: none;">
    <div class="submenu-container">
      <a href="{{ url_for('admin.administration') }}" class="submenu-item">
        <span class="submenu-icon">🏠</span>
        <span class="submenu-text">Accueil</span>
      </a>
      <a href="{{ url_for('admin.admin_clients') }}" class="submenu-item">
        <span class="submenu-icon">📋</span>
        <span class="submenu-text">Liste des Clients</span>
      </a>
      <a href="{{ url_for('admin.admin_invitations') }}" class="submenu-item">
        <span class="submenu-icon">📧</span>
        <span class="submenu-text">Invitations</span>
      </a>
      <a href="{{ url_for('admin.admin_clients_pending') }}" class="submenu-item">
        <span class="submenu-icon">⏳</span>
        <span class="submenu-text">Clients en Attente</span>
      </a>
      <a href="{{ url_for('parametrage.parametrage_vehicules') }}" class="submenu-item">
        <span class="submenu-icon">🚛</span>
        <span class="submenu-text">Types de Véhicules</span>
      </a>
      <a href="{{ url_for('parametrage.parametrage_energies') }}" class="submenu-item">
        <span class="submenu-icon">⚡</span>
        <span class="submenu-text">Gestion des Énergies</span>
      </a>
      <a href="{{ url_for('parametrage.parametrage_impact') }}" class="submenu-item">
        <span class="submenu-icon">🌱</span>
        <span class="submenu-text">Configuration de l'Impact</span>
      </a>
      <a href="{{ url_for('parametrage.parametrage_systeme') }}" class="submenu-item">
        <span class="submenu-icon">⚙️</span>
        <span class="submenu-text">Paramètres Système</span>
      </a>
      <a href="{{ url_for('debug.debug_page') }}" class="submenu-item">
        <span class="submenu-icon">🔧</span>
        <span class="submenu-text">Debug</span>
      </a>
    </div>
  </nav>

  <main class="content">
    {% block content %}{% endblock %}
  </main>

  <footer class="main-footer">
    <p>&copy; 2025 Green Calc</p>
  </footer>

  <script>
    // Gestion des barres de sous-menu
    document.addEventListener('DOMContentLoaded', function() {
      const myxploitTrigger = document.getElementById('myxploit-menu-trigger');
      const adminTrigger = document.getElementById('admin-menu-trigger');
      const myxploitSubmenu = document.getElementById('myxploit-submenu');
      const adminSubmenu = document.getElementById('admin-submenu');
      
      // Marquer l'élément actif selon la page courante
      function markActiveMenuItem() {
        const currentPath = window.location.pathname;
        
        // Supprimer toutes les classes active
        document.querySelectorAll('.submenu-item').forEach(item => {
          item.classList.remove('active');
        });
        
        // Marquer l'élément actif selon le chemin
        const activeItem = document.querySelector(`.submenu-item[href="${currentPath}"]`);
        if (activeItem) {
          activeItem.classList.add('active');
        }
      }
      
      // Fonction pour masquer toutes les barres de sous-menu
      function hideAllSubmenus() {
        myxploitSubmenu.style.display = 'none';
        adminSubmenu.style.display = 'none';
      }
      
      // Fonction pour afficher une barre de sous-menu
      function showSubmenu(submenu) {
        hideAllSubmenus();
        submenu.style.display = 'block';
      }
      
      // Marquer l'élément actif au chargement
      markActiveMenuItem();
      
      // Gestion du survol sur MyXploit
      if (myxploitTrigger) {
        myxploitTrigger.addEventListener('mouseenter', function() {
          showSubmenu(myxploitSubmenu);
        });
        
        // Garder le sous-menu visible quand on survole la barre
        myxploitSubmenu.addEventListener('mouseenter', function() {
          showSubmenu(myxploitSubmenu);
        });
        
        // Masquer quand on quitte la zone
        myxploitSubmenu.addEventListener('mouseleave', function() {
          hideAllSubmenus();
        });
      }
      
      // Gestion du survol sur Administration
      if (adminTrigger) {
        adminTrigger.addEventListener('mouseenter', function() {
          showSubmenu(adminSubmenu);
        });
        
        // Garder le sous-menu visible quand on survole la barre
        adminSubmenu.addEventListener('mouseenter', function() {
          showSubmenu(adminSubmenu);
        });
        
        // Masquer quand on quitte la zone
        adminSubmenu.addEventListener('mouseleave', function() {
          hideAllSubmenus();
        });
      }
      
      // Masquer les sous-menus quand on clique ailleurs
      document.addEventListener('click', function(e) {
        if (!myxploitTrigger.contains(e.target) && 
            !adminTrigger.contains(e.target) && 
            !myxploitSubmenu.contains(e.target) && 
            !adminSubmenu.contains(e.target)) {
          hideAllSubmenus();
        }
      });
      
      // Masquer les sous-menus au scroll
      window.addEventListener('scroll', function() {
        hideAllSubmenus();
      });
      
      // Marquer l'élément actif lors des changements de page (pour SPA)
      window.addEventListener('popstate', function() {
        markActiveMenuItem();
      });
      
      // Gestion des menus déroulants CSS
      const dropdowns = document.querySelectorAll('.dropdown');
      
      // Fonction pour fermer tous les menus
      function closeAllDropdowns() {
        dropdowns.forEach(dropdown => {
          const menu = dropdown.querySelector('.dropdown-menu');
          if (menu) {
            menu.classList.remove('open');
          }
        });
      }
      
      dropdowns.forEach(dropdown => {
        const trigger = dropdown.querySelector('a');
        const menu = dropdown.querySelector('.dropdown-menu');
        
        if (trigger && menu) {
          // Clic sur le trigger pour ouvrir/fermer
          trigger.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Si le menu est déjà ouvert, le fermer
            if (menu.classList.contains('open')) {
              menu.classList.remove('open');
            } else {
              // Fermer tous les autres menus et ouvrir celui-ci
              closeAllDropdowns();
              menu.classList.add('open');
            }
          });
        }
      });
      
      // Fermer tous les menus quand on clique ailleurs
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.dropdown')) {
          closeAllDropdowns();
        }
      });
    });
  </script>

</body>
</html>
